Description: fix denial of service and possible code execution via
 integer overflow in PL_ArenaAllocate.
Origin: backport, https://hg.mozilla.org/projects/nspr/rev/4df6bc35be64
Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=927687 (private)

Index: nspr-4.9.5/mozilla/nsprpub/lib/ds/plarena.c
===================================================================
--- nspr-4.9.5.orig/mozilla/nsprpub/lib/ds/plarena.c	2012-05-31 17:54:48.000000000 -0400
+++ nspr-4.9.5/mozilla/nsprpub/lib/ds/plarena.c	2014-01-22 15:56:14.231639457 -0500
@@ -196,8 +196,12 @@
     /* attempt to allocate from the heap */ 
     {  
         PRUint32 sz = PR_MAX(pool->arenasize, nb);
-        sz += sizeof *a + pool->mask;  /* header and alignment slop */
-        a = (PLArena*)PR_MALLOC(sz);
+        if (PR_UINT32_MAX - sz < sizeof *a + pool->mask) {
+            a = NULL;
+        } else {
+            sz += sizeof *a + pool->mask;  /* header and alignment slop */
+            a = (PLArena*)PR_MALLOC(sz);
+        }
         if ( NULL != a )  {
             a->limit = (PRUword)a + sz;
             a->base = a->avail = (PRUword)PL_ARENA_ALIGN(pool, a + 1);
