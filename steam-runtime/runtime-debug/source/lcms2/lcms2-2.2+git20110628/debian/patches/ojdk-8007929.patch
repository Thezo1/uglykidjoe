# HG changeset patch
# User bae
# Date 1363852924 -14400
# Node ID 2c71b4f2104b4951376604d50d5ecd176cd5acc7
# Parent  4047e9efcbd0966d8cc15d51f9b25ae5b141e239
8007929: Improve CurvesAlloc

Index: lcms2-2.2+git20110628/src/cmsopt.c
===================================================================
--- lcms2-2.2+git20110628.orig/src/cmsopt.c	2013-07-01 10:54:09.000000000 -0500
+++ lcms2-2.2+git20110628/src/cmsopt.c	2013-07-01 10:54:09.000000000 -0500
@@ -1135,6 +1135,15 @@
     for (i=0; i < nCurves; i++) {
 
         c16->Curves[i] = _cmsCalloc(ContextID, nElements, sizeof(cmsUInt16Number));
+        if (c16->Curves[i] == NULL) {
+            for (j=0; j < i; j++) {
+                _cmsFree(ContextID, c16->Curves[j]);
+            }
+            _cmsFree(ContextID, c16->Curves);
+            _cmsFree(ContextID, c16);
+
+            return NULL;
+        }
 
         if (nElements == 256) {
 
